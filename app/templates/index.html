{% extends "base.html" %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="columns is-centered">
            <div class="column is-fullwidth">

                <!-- ロゴ部分 -->
                <div class="phishmonitor-logo">
                    <h1 class="title">Phish Monitor</h1>
                </div>
                
                <div>
                    <p>フィッシングサイトの可能性があるドメインを一覧化し、死活監視します</p>
                </div>

                <div style="margin-top: 20px;">
                    <!-- 検索フォーム -->
                    <form action="{{ url_for('main.index') }}" method="get" class="field has-addons has-addons-centered">
                        <p class="control">
                            <input class="input" type="text" id="keyword" name="keyword" placeholder="example.co.jp" required>
                        </p>
                        <p class="control">
                            <button class="button is-info" type="submit">検索</button>
                        </p>
                    </form>
                </div>

                <!-- index.html内の検索フォームの下に追加 -->

                <h2 class="subtitle">「{{ keyword }}」の検索結果</h2>
                <table class="table is-fullwidth">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>ドメイン</th>
                            <th>WHOIS登録日</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for nrd in nrds %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ nrd.domain_name }}</td>
                        <td>{{ nrd.registration_date }}</td>
                        <td>
                            <form action="{{ url_for('main.add_to_watchlist') }}" method="post">
                                <input type="hidden" name="nrd_id" value="{{ nrd.id }}">
                                <input type="hidden" name="keyword" value="{{ request.args.get('keyword', '') }}">
                                <button type="submit" class="button is-small is-primary">監視対象追加</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <!-- 管理者用ボタン -->
                {% if current_user.is_authenticated and current_user.is_admin %}
                    <button id="downloadNrd" class="button is-primary">NRDダウンロード</button>
                    <button id="storeDb" class="button is-primary">DB格納</button>
                {% endif %}

                <!-- ログインリンク -->
                <p>監視対象に追加する際は<a href="/auth/login">ログイン</a>してください。</p>
            </div>
        </div>
    </div>
</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/static/script.js"></script>
{% endblock %}
